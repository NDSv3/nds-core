#+======================================================================
# $HeadURL: https://svnpub.iter.org/codac/iter/codac/dev/units/m-codac-unit-templates/branches/codac-core-5.4/templates/cpp/main/c++/lib/Makefile.template $
# $Id: Makefile.template 75208 2017-02-03 09:19:23Z cesnikt $
#
# Project       : CODAC Core System
#
# Description   : $progName Makefile
#
# Author        : This file was generated by CODAC development toolkit
#
# Copyright (c) : 2010-2017 ITER Organization,
#                 CS 90 046
#                 13067 St. Paul-lez-Durance Cedex
#                 France
#
# This file is part of ITER CODAC software.
# For the terms and conditions of redistribution or use of this software
# refer to the file ITER-LICENSE.TXT located in the top level directory
# of the distribution package.
#
#-======================================================================

LIBNAME=nds3

#libraries
LIBRARIES=
LIBRARY_DIRS=
LDLIBS=-L$(CODAC_ROOT)/lib $(foreach libs,$(LIBRARY_DIRS),-L$(libs) -Wl,-rpath,$(libs)) $(foreach libs,$(LIBRARIES),-l$(libs))

#includes
INCLUDE_DIRS=. ../include 
INCLUDES=$(foreach inc,$(INCLUDE_DIRS),-I$(inc))

#Sources
SOURCE_DIR=.
SOURCES:=$(SOURCE_DIR)/$(wildcard *.cpp)

TARGET=../../..
LIBRARY_DIR=$(TARGET)/lib
OBJECT_DIR=$(SOURCE_DIR)/.obj
SHAREDLIBRARY=$(LIBRARY_DIR)/lib$(LIBNAME).so
STATICLIBRARY=$(LIBRARY_DIR)/lib$(LIBNAME).a

#Objects
OBJECTS:=$(addprefix $(OBJECT_DIR)/,$(patsubst %.cpp,%.o,$(notdir $(SOURCES))))

CC=g++

STD=-std=c++11
DEFS=-DNDS3_DLL -DNDS3_DLL_EXPORTS
#CFLAGS=-c -Wall -fPIC 
CXXFLAGS=-c $(STD) -Wall -Wextra -pedantic -fPIC -pthread  -fvisibility-inlines-hidden $(DEFS) 
LDFLAGS= -shared 

ifeq ($(COVERAGE),true)
    #CFLAGS+= -O0 -g --coverage
    CXXFLAGS+= -O0 -g --coverage
    LDFLAGS+= --coverage
endif

all: $(SOURCES) $(SHAREDLIBRARY) $(STATICLIBRARY)

clean:
    rm -rf "$(SHAREDLIBRARY)" "$(STATICLIBRARY)" "$(OBJECT_DIR)" "$(HTARGETS)"

$(SHAREDLIBRARY): $(OBJECTS)
    @mkdir -p $(LIBRARY_DIR)
    $(CC) $(LDFLAGS) $(LDLIBS) $(OBJECTS) -o $(SHAREDLIBRARY)

$(STATICLIBRARY): $(OBJECTS)
    @mkdir -p $(LIBRARY_DIR)
    $(AR) rcs $@ $^

$(OBJECT_DIR)/%.o: $(SOURCE_DIR)/%.cpp 
    @mkdir -p $(OBJECT_DIR)
    $(CC) $(CXXFLAGS) $(INCLUDES) $< -o $@
